<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Permissions</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; margin: 0; padding: 2rem; }
        .container { max-width: 900px; margin: auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2, h3 { border-bottom: 1px solid #ccc; padding-bottom: 0.5rem; }
        .document-card { background: #f8f9fa; padding: 1.5rem; border-radius: 4px; margin-bottom: 1.5rem; }
        .permission-form input { margin-right: 0.5rem; }
        .user-list { list-style: none; padding-left: 0; }
        .user-list li { background: #e9ecef; padding: 0.5rem; border-radius: 3px; display: inline-block; margin-right: 0.5rem; }
        .upload-section { margin-bottom: 2rem; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Admin Panel</h2>

        <div class="upload-section">
            <h3>Upload New Document</h3>
            <form action="/upload" method="POST" enctype="multipart/form-data">
                <input type="file" name="pdfFile" accept=".pdf" required>
                <button type="submit">Upload</button>
            </form>
        </div>

        <h3>Manage Permissions</h3>
        <div id="document-list"></div>
    </div>

    <script>
        const docListContainer = document.getElementById('document-list');

        function renderData(data) {
            docListContainer.innerHTML = ''; // Clear current list
            const { documents, permissions } = data;

            if (documents.length === 0) {
                docListContainer.innerHTML = '<p>No documents have been uploaded yet.</p>';
                return;
            }

            documents.forEach(doc => {
                const card = document.createElement('div');
                card.className = 'document-card';

                const usersWithAccess = permissions
                    .filter(p => p.documentId === doc.id)
                    .map(p => p.email);

                let userListHTML = '<p>No users have access yet.</p>';
                if (usersWithAccess.length > 0) {
                    userListHTML = '<ul class="user-list">' + usersWithAccess.map(email => `<li>${email}</li>`).join('') + '</ul>';
                }

                card.innerHTML = `
                    <h4>${doc.originalName}</h4>
                    <p><strong>Users with access:</strong></p>
                    ${userListHTML}
                    <hr>
                    <form action="/grant-access" method="POST" class="permission-form">
                        <input type="hidden" name="documentId" value="${doc.id}">
                        <input type="email" name="email" placeholder="user@example.com" required>
                        <button type="submit">Grant Access</button>
                    </form>
                `;
                docListContainer.appendChild(card);
            });
        }

        fetch('/api/data')
            .then(response => response.json())
            .then(renderData)
            .catch(error => {
                console.error('Error fetching data:', error);
                docListContainer.innerHTML = '<p>Error loading data.</p>';
            });
    </script>
</body>
</html>